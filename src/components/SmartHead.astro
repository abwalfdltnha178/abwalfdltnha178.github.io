---
/*
SmartHead.astro
ورودی‌ها:
  - title: عنوان پست (string)
  - content: محتوای HTML پست (string) — فرض می‌کنیم HTML از قبل تولید شده است (مثلاً await Content() یا await PostContent()).

خلاصهٔ رفتار:
  - اولین <img> را برای og:image/tw:image استخراج می‌کند
  - 200 کاراکتر اول متن بدون تگ را برای description می‌سازد
  - کلمات بولد شده `**کلمه**` را به عنوان keywords استخراج می‌کند
*/
const { title = '', content = '' } = Astro.props;

// Normalize content to string
const htmlContent = typeof content === 'string' ? content : String(content || '');

// 1) پیدا کردن اولین تصویر (src)
const imgMatch = htmlContent.match(/<img[^>]+src=(?:["'])([^"']+)(?:["'])/i);
let ogImage = imgMatch ? imgMatch[1] : null;

// اگر تصویر relative است، آن را بدون تغییر بگذار (یا در صورت نیاز اینجا prefix اضافه کن)
if (!ogImage) {
  // fallback به تصویر پیش‌فرض در public/ (توصیه: /assets/og-default.jpg یا /default-og.jpg)
  ogImage = '/img/IMG_20250330_204234_524.jpg';
}

// 2) ساختن description از متن (حذف تگ‌ها و فشرده‌سازی فضاها)
const textOnly = htmlContent.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
const description = textOnly.slice(0, 200);

// 3) استخراج کلمات bold مثل **کلمه**
const boldMatches = [];
const reBold = /\*\*(.*?)\*\*/g;
let m;
while ((m = reBold.exec(htmlContent)) !== null) {
  if (m[1]) boldMatches.push(m[1].trim());
}
const keywords = Array.from(new Set(boldMatches.filter(k => k.length > 1))).join(', ');
---

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{title}</title>

  <meta name="description" content={description} />
  {keywords ? <meta name="keywords" content={keywords} /> : null}

  <!-- Open Graph -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={ogImage} />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImage} />

  <meta property="og:image" content="https://abwalfdltnha178.github.io/img/IMG_20250330_204234_524.jpg">
  <meta name="twitter:image" content="https://abwalfdltnha178.github.io/img/IMG_20250330_204234_524.jpg">

<!-- Open Graph Meta Tags for Other Social Profiles -->
  <meta property="og:see_also" content="https://facebook.com/abwalfdltnha178">
  <meta property="og:see_also" content="https://linkedin.com/in/abwalfdltnha178">
  <meta property="og:see_also" content="https://instagram.com/abwalfdltnha178">
  <meta property="og:see_also" content="https://youtube.com/@abwalfdltnha178">
  <meta property="og:see_also" content="https://pinterest.com/abwalfdltnha178">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "ابوالفضل تنها",
  "url": "https://abwalfdltnha178.github.io",
  "sameAs": [
    "https://twitter.com/abwalfdltnha178",
    "https://www.facebook.com/abwalfdltnha178",
    "https://www.linkedin.com/in/abwalfdltnha178",
    "https://github.com/abwalfdltnha178",
    "https://www.instagram.com/abwalfdltnha"
  ]
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "url": "https://abwalfdltnha178.github.io",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://abwalfdltnha178.github.io/fa/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "خانه",
      "item": "https://abwalfdltnha178.github.io"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "درباره",
      "item": "https://abwalfdltnha178.github.io/fa/about/"
    }
  ]
}
</script>


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-THYXH8M4VG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-THYXH8M4VG');
</script>

 <!-- <link rel="stylesheet" href="{{ "/assets/main.css" | relative_url }}"> 

<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/dark.min.css" media="(prefers-color-scheme: dark)" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/default.min.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
-->

<!-- Algolia Search Library --
<script src="https://cdn.jsdelivr.net/npm/algoliasearch@4.24.0/dist/algoliasearch-lite.umd.js" integrity="sha256-b2n6oSgG4C1stMT/yc/ChGszs9EY/Mhs6oltEjQbFCQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.75.5/dist/instantsearch.production.min.js" integrity="sha256-Ge9l2WgQoXm9fEH5EX/9oXKOjZVrpOwrMK7vAF2oWKg=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@8.5.1/themes/reset-min.css" integrity="sha256-KvFgFCzgqSErAPu6y9gz/AhZAvzK48VJASu3DpNLCEQ=" crossorigin="anonymous">
<script type="module" src="/assets/js/search.js"></script>

<script
  src="https://js.sentry-cdn.com/09cf2daed1819b4bc93b6f8618539b88.min.js"
  crossorigin="anonymous"
></script>
<script type="text/javascript">document.addEventListener("DOMContentLoaded", function(){myUndefinedFunction();})</script>
-->

<script>(function(){function e(){["click","mousemove","scroll","touchstart"].forEach(t=>document.removeEventListener(t,e));!function(w,d,n){w.yektanetAnalyticsObject=n;w[n]=w[n]||function(){w[n].q.push(arguments)};w[n].q=w[n].q||[];var h=d.getElementsByTagName("head")[0],t=new Date,u="https://cdn.yektanet.com/superscript/sOorBG4l/native-abwalfdltnha178.github.io-37808/yn_pub.js?v="+t.getFullYear()+"0"+t.getMonth()+"0"+t.getDate()+"0"+t.getHours(),l=d.createElement("link");l.rel="preload";l.as="script";l.href=u;h.appendChild(l);var s=d.createElement("script");s.async=!0;s.src=u;h.appendChild(s)}(window,document,"yektanet")}["click","mousemove","scroll","touchstart"].forEach(t=>document.addEventListener(t,e));})();</script>

</head>
